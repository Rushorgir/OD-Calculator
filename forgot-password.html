<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OD Manager â€” Forgot Password</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“…</text></svg>">
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="supabase-config.js"></script>
</head>
<body class="login-page">
    <main style="min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem;">
        <div style="max-width:480px;width:100%;display:flex;justify-content:center;">
            <div class="card" style="width:100%;">
                <div class="card__header">
                    <h2 style="margin:0">Forgot Password</h2>
                    <p style="margin:6px 0 0;color:var(--color-text-secondary);font-size:13px">Enter your email to reset your password</p>
                </div>
                <div class="card__body">
                    <form id="forgotPasswordForm">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input id="forgotEmail" type="email" class="form-control" placeholder="you@example.com" required />
                        </div>
                        <button type="submit" class="btn btn--primary btn--full-width">Send Reset Link</button>
                    </form>
                    <div style="margin-top:12px;text-align:center">
                        <small><a href="index.html">Back to login</a></small>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="toastContainer" class="toast-container"></div>

    <script>
        const forgotForm = document.getElementById('forgotPasswordForm');

        forgotForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value.trim();
            if (!email) return showToast('Please provide your email', 'warning');

            if (typeof supabaseClient === 'undefined') return showToast('Supabase is not configured. Add your keys to supabase-config.js', 'error');

            const { data, error } = await supabaseClient.auth.resetPasswordForEmail(email, {
                redirectTo: window.location.origin + '/reset-password.html'
            });

            if (error) {
                showToast(error.message || 'Failed to send reset link', 'error');
                return;
            }

            showToast('Reset link sent! Check your email.', 'success');
        });

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) return;
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            setTimeout(() => toast.remove(), 3500);
        }
    </script>
</body>
</html>